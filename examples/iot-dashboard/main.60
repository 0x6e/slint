
struct Palette := {
    menuBar : brush,
    mainContent : brush,
    box : brush,
    lightDisplay : brush,
    pieChart : brush,
    roundButton : brush,
    weekdayBox : brush,
    text : brush,
    shadow : brush,
}

global Skin := {
    property<bool> day: true;
    property<Palette> palette : day ? {
       menuBar : #6D7BFB,
       mainContent :  #fbfbfb,
       box :   #ffffff,
       lightDisplay : #ffffff,
       pieChart : #ffffff,
       roundButton : #f7f7f7,
       weekdayBox : #f4f4f4,
       text : #000,
       shadow : #0001, // ### added alpha
    } : {
       menuBar : #2937A7,
       mainContent : #040404,
       box : #000000,
       lightDisplay : #000000,
       pieChart : #000000,
       roundButton : #0a0a0a,
       weekdayBox : #0c0c0c,
       text : #fff,
       shadow : #fff1, // ### added alpha
    };

    property<float> f: 1.5; // FIXME: why do the font looks completely different with the same size on the QML demo

    // From Skin::initHints in Skin.cpp
    property <length> DefaultFont: 12pt * f;
    property <length> TinyFont: 9pt * f;
    property <length> SmallFont: 10pt * f;
    property <length> MediumFont: 13pt * f;
    property <length> LargeFont: 20pt * f;
    property <length> HugeFont: 27pt * f; // (also, bold)
    property <length> TitleFont: 10pt * f; // (also, bold)
}

// From TopBar.cpp
TopBar := HorizontalLayout {
    for item in [
        { string: "Living Room", progress: 25, value: 175, color: #ff3122, gradient: @linear-gradient(0deg, #FF5C00, #FF3122) },
        { string: "Bedroom", progress: 45, value: 205, color: #6776ff, gradient: @linear-gradient(0deg, #6776FF, #6100FF) },
        { string: "Bathroom", progress: 15, value: 115, color: #f99055, gradient: @linear-gradient(0deg, #FFCE50, #FF3122) },
        { string: "Kitchen", progress: 86, value: 289, color: #6776ff, gradient: @linear-gradient(0deg, #6776FF, #6100FF) },
    ] : VerticalLayout {
        Text {
            font_size: Skin.SmallFont;
            text: item.string;
        }
        HorizontalLayout {
            Rectangle {
                border-color: item.gradient;
                border-width: 5px;
                border-radius: width/2;
                Text {
                    width: 100%;
                    height: 100%;
                    vertical_alignment: center;
                    horizontal_alignment: center;
                    text: item.progress + "%";
                    color: item.color;
                }
            }
            VerticalLayout {
                Text { text: item.value; }
                Text { text: "kwH"; }
            }
            Rectangle {}
        }
    }
    VerticalLayout {
        Text {
            text: "Current time";
            font_size: Skin.TitleFont;
            font_weight: 700;
        }
        Text {
            // FIXME: actual time
            text: "10:02:45";
            font_size: Skin.HugeFont;
            font_weight: 700;
            color: #6776FF;
        }
    }
}

// From Box.cpp
Box := Rectangle {
    property <string> title;
    background: Skin.palette.box;
    drop-shadow-offset-x: 6px;
    drop-shadow-offset-y: 6px;
    drop-shadow-blur: 6px;
    drop-shadow-color: Skin.palette.shadow;
    VerticalLayout {
        if (root.title != "") : Text {
            text <=> root.title;
            font_size: Skin.TitleFont;
        }
        padding: 15px;
        @children
    }
}

// From RoundedIcon.cpp
RoundedIcon := Rectangle {
    property <bool> isBright;
    property <bool> isSmall;
    property <image> iconName <=> m_graphicLabel.source;
    background: isBright ? @linear-gradient(180deg, #ff7d34, #ff3122) : @linear-gradient(180deg, #6776FF, #6100FF);
    border-radius: 6px;
    height: isSmall ? 60px : 68px;
    width: isSmall ? 60px : 68px;
    m_graphicLabel := Image {
        x: (parent.width - width) / 2;
        y: (parent.height - height) / 2;
    }
}

//from Usage.cpp
UsageSpacer := Text {
    text: "_____";
    font_size: Skin.SmallFont;
    color: #dddddd;
    horizontal_stretch: 2;
}

Usage := Box {
    title: "Usage";
    HorizontalLayout {
        Text { text: "Usage Today"; font_size: Skin.SmallFont; }
        UsageSpacer { }
        Text { text: "0,5 kwH"; font_size: Skin.SmallFont; }
    }
    HorizontalLayout {
        Text { text: "Usage this month"; font_size: Skin.SmallFont; }
        UsageSpacer { }
        Text { text: "60 kwH"; font_size: Skin.SmallFont; }
    }
    HorizontalLayout {
        Text { text: "Total working hours"; font_size: Skin.SmallFont; }
        UsageSpacer { }
        Text { text: "125 hrs"; font_size: Skin.SmallFont; }
    }
}

// From UpAndDownButton.cpp
RoundButton := Image { //### QskPushButton
    property <bool> is_up; // ### QskAspect
    Image {
        source: is_up ? @image-url("images/up.svg") : @image-url("images/down.svg");
        x: (parent.width - width) / 2;
        y: (parent.height - height) / 2;
    }
}
UpAndDownButton := Rectangle {
    // FIXME: this is actually on the RoundButton
    border-radius: 30px;
    width: 45px;
    background: Skin.palette.roundButton;
    VerticalLayout {
        RoundButton { is_up: true; }
        RoundButton { is_up: false; }
    }
}

// From BoxWithButtons.cpp
ButtonValueLabel := Text {
    property <string> value <=> text;
    font_size: Skin.HugeFont;
    font_weight: 700;
    color: #929cb2;
}

TitleAndValueBox := VerticalLayout { horizontal-stretch: 100; }

BoxWithButtons := Box {
    property <image> iconFile <=> ri.iconName; //### in original, this is derived from title
    property <string> value <=> val.value;
    property <bool> isBright <=> ri.isBright;
    property <string> title_ <=> titleLabel.text;
    HorizontalLayout {
        padding: 8px;
        spacing: 20px;
        VerticalLayout {  // FIXME: there is no such layout in the original, we should so without it
            alignment: center;
            ri := RoundedIcon { }
        }
        TitleAndValueBox {
            titleLabel := Text {
                font_size: Skin.TitleFont;
                font_weight: 700;
            }
            val := ButtonValueLabel { }
        }
        UpAndDownButton { }
    }
}

IndoorTemperature := BoxWithButtons {
    title_: "Indoor Temperature";
    iconFile: @image-url("images/indoor-temperature.png");
    value: "+24";
    isBright: true;
}
Humidity := BoxWithButtons {
    title_: "Humidity";
    iconFile: @image-url("images/humidity.png");
    value: "30%";
    isBright: false;
}

// from MyDevices.cpp
Device := VerticalLayout {
    property <string> name <=> t.text;
    property <image> iconName <=> ri.iconName; // ### based on the name in the original
    property <bool> isBright <=> ri.isBright;
    HorizontalLayout { // ### FIXME: this latour is not in the original
        alignment: center;
        ri := RoundedIcon {
            opacity: 0.15;
        }
    }
    t := Text {
        font_size: Skin.TinyFont;
        horizontal_alignment: center;
    }
}

MyDevices := Box {
    title: "My devices";
    GridLayout {
        spacing: 15px;
        Row {
            Device{
                name: "Lamps";
                iconName: @image-url("images/lamps.png");
                isBright: true;
            }
            Device{
                name: "Music System";
                iconName: @image-url("images/music-system.png");
                isBright: false;
            }
        }
        Row {
            Device{
                name: "AC";
                iconName: @image-url("images/ac.png");
                isBright: false;
            }
            Device{
                name: "Router";
                iconName: @image-url("images/router.png");
                isBright: true;
            }
        }
    }
}

// ## FIXME
UsageDiagram := Box {
    Rectangle {}
}

MainContent := VerticalLayout {
    spacing: 24px;
    TopBar { }

    GridLayout {
        padding-left: 19px;
        padding-top: 0px;
        padding-right: 17px;
        padding-bottom: 24px;

        Usage {
            rowspan: 2;
        }
        IndoorTemperature {
            row: 0; col: 1;
        }
        Humidity {
            row: 1; col: 1;
        }
        MyDevices {
            row: 0; col: 2;
            rowspan: 2;
        }
        UsageDiagram {
            row: 2; col: 0;
            colspan: 2;
        }
        /*LightIntensity {
            row: 2; col: 2;
        }*/
    }
}

// From MenuBar.cpp
MenuItem := Rectangle {
    property <image> icon <=> i.source;
    property<string> name <=> t.text;
    property<bool> active;
    background: active ? rgba(100%, 100%, 100%, 14%) : ma.has_hover ? rgba(100%, 100%, 100%, 9%) : transparent;
    ma := TouchArea {}
    HorizontalLayout {
        alignment: start;
        padding: 8px;
        padding-left: 30px;
        padding-right: 30px;
        i := Image { }
        t := Text { color: white; }
    }
}

// From MenuBar.cpp
MenuBar := Rectangle {
    background: Skin.palette.menuBar;
    property<int> active: 0;
    minimum-width: 140px;
    VerticalLayout {
        padding-left: 0px;
        padding-top: 35px;
        padding-right: 0px;
        padding-bottom: 12px;
        spacing: 8px;
        Image {
            source: @image-url("images/main-icon.png");
        }
        //###  In the original, the icon is derived from the name
        for entry[idx] in [
            { name: "Dashboard", icon: @image-url("images/dashboard.png") },
            { name: "Rooms", icon: @image-url("images/rooms.png") },
            { name: "Devices", icon: @image-url("images/devices.png") },
            { name: "Statistics", icon: @image-url("images/statistics.png") },
            { name: "Storage", icon: @image-url("images/storage.png") },
            { name: "Members", icon: @image-url("images/members.png") },
        ] : MenuItem {
            name: entry.name;
            icon: entry.icon;
            active: root.active == idx;
        }
        Rectangle {}
        MenuItem { name: "Logout"; icon: @image-url("images/logout.png"); }
    }
}


MainWindow := Window {
    width: 1024px;
    height: 600px;
    title: "IOT dashboard";
    HorizontalLayout {
        padding: 0; spacing: 0;
        MenuBar {}
        MainContent {}
    }
}